<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Exporting spatial data â€¢ raem</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Exporting spatial data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">raem</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/vign-01-overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/vign-02-export-spatial.html">Exporting spatial data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cneyens/raem/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Exporting spatial data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cneyens/raem/blob/main/vignettes/vign-02-export-spatial.Rmd" class="external-link"><code>vignettes/vign-02-export-spatial.Rmd</code></a></small>
      <div class="d-none name"><code>vign-02-export-spatial.Rmd</code></div>
    </div>

    
    
<p><code>raem</code> does not contain functions to export output to
spatial data formats such as vector data or rasters. Other R packages do
have this functionality however. This vignette describes a way to create
spatial data from <code>raem</code> output using other,
well-established, packages.</p>
<div class="section level2">
<h2 id="create-an-example-aem-model">Create an example AEM model<a class="anchor" aria-label="anchor" href="#create-an-example-aem-model"></a>
</h2>
<p>As an example model, two extraction wells in a phreatic aquifer with
uniform background flow and areal recharge are modeled. The output grid
is defined and head contours are plotted.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cneyens/raem" class="external-link">raem</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># aquifer parameters</span></span>
<span><span class="va">k</span> <span class="op">=</span> <span class="fl">10</span>    <span class="co"># hydraulic conductivity, m/d</span></span>
<span><span class="va">top</span> <span class="op">=</span> <span class="fl">30</span>  <span class="co"># aquifer top elevation, m</span></span>
<span><span class="va">base</span> <span class="op">=</span> <span class="fl">0</span>  <span class="co"># aquifer bottom elevation, m</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">0.2</span>   <span class="co"># aquifer effective porosity, -</span></span>
<span></span>
<span><span class="co"># create elements</span></span>
<span><span class="va">w1</span> <span class="op">=</span> <span class="fu"><a href="../reference/well.html">well</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">500</span>, y <span class="op">=</span> <span class="fl">100</span>, Q <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">w2</span> <span class="op">=</span> <span class="fu"><a href="../reference/well.html">well</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">300</span>, <span class="op">-</span><span class="fl">200</span>, Q <span class="op">=</span> <span class="fl">1200</span><span class="op">)</span></span>
<span><span class="va">as</span> <span class="op">=</span> <span class="fu"><a href="../reference/areasink.html">areasink</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">1500</span>, N <span class="op">=</span> <span class="fl">0.3</span> <span class="op">/</span> <span class="fl">365</span><span class="op">)</span></span>
<span><span class="va">uf</span> <span class="op">=</span> <span class="fu"><a href="../reference/uniformflow.html">uniformflow</a></span><span class="op">(</span>TR <span class="op">=</span> <span class="va">k</span> <span class="op">*</span> <span class="op">(</span><span class="va">top</span> <span class="op">-</span> <span class="va">base</span><span class="op">)</span>, gradient <span class="op">=</span> <span class="fl">0.002</span>, angle <span class="op">=</span> <span class="op">-</span><span class="fl">135</span><span class="op">)</span> <span class="co"># SW direction</span></span>
<span><span class="va">rf</span> <span class="op">=</span> <span class="fu"><a href="../reference/constant.html">constant</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1000</span>, y <span class="op">=</span> <span class="fl">1000</span>, h <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create and solve model</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="../reference/aem.html">aem</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">top</span>, <span class="va">base</span>, <span class="va">n</span>, <span class="va">w1</span>, <span class="va">w2</span>, <span class="va">as</span>, <span class="va">uf</span>, <span class="va">rf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># output grid</span></span>
<span><span class="va">xg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1200</span>, <span class="fl">1000</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">yg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">700</span>, <span class="fl">500</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot head contours</span></span>
<span><span class="fu"><a href="../reference/contours.html">contours</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">xg</span>, <span class="va">yg</span>, col <span class="op">=</span> <span class="st">'dodgerblue'</span>, nlevels <span class="op">=</span> <span class="fl">20</span>, labcex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>         xlab <span class="op">=</span> <span class="st">'x (m)'</span>, ylab <span class="op">=</span> <span class="st">'y (m)'</span><span class="op">)</span></span></code></pre></div>
<p><img src="vign-02-export-spatial_files/figure-html/create-model-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="exporting-as-spatial-vector-data">Exporting as spatial vector data<a class="anchor" aria-label="anchor" href="#exporting-as-spatial-vector-data"></a>
</h2>
<p>The contours can be exported as a spatial vector format using the <a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> and <a href="https://isoband.r-lib.org/" class="external-link">isoband</a> packages. <code>sf</code>
is widely used in the R community to handle spatial vector data.
<code>isoband</code> is a lightweight package containing fast contouring
algorithms used in i.a. <a href="https://ggplot2.tidyverse.org/" class="external-link">ggplot2</a>. A contouring grid of
the variable of interest is required. Optionally, the origin of the
<code>raem</code> model grid at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">(x, y) = (0,0)</annotation></semantics></math>
can be specified in a projected coordinate system so that the exported
contours are georeferenced. The set of contour lines is generated with
<code><a href="https://isoband.r-lib.org/reference/isobands.html" class="external-link">isoband::isolines()</a></code> and converted to a <code>sf</code>
simple feature geometry collection, which can then be used as a simple
feature geometry column in a <code>sf</code> simple feature object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://isoband.r-lib.org" class="external-link">isoband</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a 10 by 10 m contouring grid and get the heads as a grid</span></span>
<span><span class="va">xg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1200</span>, <span class="fl">1000</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">yg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">700</span>, <span class="fl">500</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">h</span> <span class="op">=</span> <span class="fu"><a href="../reference/state-variables.html">heads</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">xg</span>, <span class="va">yg</span>, as.grid <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># optionally, set the x and y origin corresponding to (0, 0) </span></span>
<span><span class="co"># in the requested coordinate system</span></span>
<span><span class="va">xorigin</span> <span class="op">=</span> <span class="fl">195600</span></span>
<span><span class="va">yorigin</span> <span class="op">=</span> <span class="fl">203500</span></span>
<span><span class="va">epsg</span> <span class="op">=</span> <span class="fl">31370</span></span>
<span></span>
<span><span class="co"># create the isolines with the specified levels</span></span>
<span><span class="co"># the y-coordinates need to be reversed here for isolines()</span></span>
<span><span class="va">lvls</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">13.5</span>, <span class="fl">24.5</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">isolines</span> <span class="op">=</span> <span class="fu"><a href="https://isoband.r-lib.org/reference/isobands.html" class="external-link">isolines</a></span><span class="op">(</span><span class="va">xg</span> <span class="op">+</span> <span class="va">xorigin</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">yg</span><span class="op">)</span> <span class="op">+</span> <span class="va">yorigin</span>,</span>
<span>                    <span class="va">h</span>,</span>
<span>                    levels <span class="op">=</span> <span class="va">lvls</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to sfg object, create sfc column for sf object</span></span>
<span><span class="va">isolines_sf</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span>level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">isolines</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://isoband.r-lib.org/reference/iso_to_sfg.html" class="external-link">iso_to_sfg</a></span><span class="op">(</span><span class="va">isolines</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    crs <span class="op">=</span> <span class="va">epsg</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">isolines_sf</span><span class="op">)</span></span></code></pre></div>
<p><img src="vign-02-export-spatial_files/figure-html/export-vector-1.png" width="672"></p>
<p>To export the <code>sf</code> object to disk, the <code>sf</code>
package provides the <code><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">write_sf()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># export as shapefile</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">write_sf</a></span><span class="op">(</span><span class="va">isolines_sf</span>, <span class="st">'isolines.shp'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exporting-as-spatial-raster">Exporting as spatial raster<a class="anchor" aria-label="anchor" href="#exporting-as-spatial-raster"></a>
</h2>
<p>To create and export output as a spatial raster object such as a
GeoTIFF, the <a href="https://rspatial.github.io/terra/" class="external-link">terra</a>
package can be used. This package is the replacement of the older,
widely popular <a href="https://github.com/rspatial/raster" class="external-link">raster</a>
package. Similar to the creation of a spatial vector object, a grid of
values for the variable of interest (here hydraulic head) needs to be
specified. Optionally, the origin coordinates can be given to
georeference the output. The extent of the raster needs to be specified
explicitly from the range of the marginal grid vectors.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set extent and create raster</span></span>
<span><span class="va">extent</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">xg</span><span class="op">)</span> <span class="op">+</span> <span class="va">xorigin</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">yg</span><span class="op">)</span> <span class="op">+</span> <span class="va">yorigin</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">h</span>, crs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'epsg'</span>, <span class="va">epsg</span>, sep <span class="op">=</span> <span class="st">':'</span><span class="op">)</span>, extent <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">extent</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></code></pre></div>
<p><img src="vign-02-export-spatial_files/figure-html/terra-1.png" width="672"></p>
<p>To export the raster to disk, use the <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster()</a></code>
function from the <code>terra</code> package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">r</span>, <span class="st">'heads.tiff'</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cas Neyens.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
