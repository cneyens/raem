<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute tracelines of particles — tracelines • raem</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute tracelines of particles — tracelines"><meta name="description" content="tracelines() tracks particle locations moving forward or backward with the advective groundwater flow
by numerically integrating the velocity vector. The resulting set of connected coordinates produces the
tracelines.
endpoints() obtains the final time and locations of tracked particles."><meta property="og:description" content="tracelines() tracks particle locations moving forward or backward with the advective groundwater flow
by numerically integrating the velocity vector. The resulting set of connected coordinates produces the
tracelines.
endpoints() obtains the final time and locations of tracked particles."><meta property="og:image" content="https://cneyens.github.io/raem/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">raem</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/vign-01-overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/vign-02-export-spatial.html">Exporting spatial data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cneyens/raem/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute tracelines of particles</h1>
      <small class="dont-index">Source: <a href="https://github.com/cneyens/raem/blob/main/R/tracelines.R" class="external-link"><code>R/tracelines.R</code></a>, <a href="https://github.com/cneyens/raem/blob/main/R/plot.R" class="external-link"><code>R/plot.R</code></a></small>
      <div class="d-none name"><code>tracelines.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>tracelines()</code> tracks particle locations moving forward or backward with the advective groundwater flow
by numerically integrating the velocity vector. The resulting set of connected coordinates produces the
tracelines.</p>
<p><code>endpoints()</code> obtains the final time and locations of tracked particles.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tracelines</span><span class="op">(</span></span>
<span>  <span class="va">aem</span>,</span>
<span>  <span class="va">x0</span>,</span>
<span>  <span class="va">y0</span>,</span>
<span>  <span class="va">z0</span>,</span>
<span>  <span class="va">times</span>,</span>
<span>  forward <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  tfunc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  ncores <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">endpoints</span><span class="op">(</span><span class="va">tracelines</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'tracelines'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, y <span class="op">=</span> <span class="cn">NULL</span>, add <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"l"</span>, arrows <span class="op">=</span> <span class="cn">FALSE</span>, marker <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-aem">aem<a class="anchor" aria-label="anchor" href="#arg-aem"></a></dt>
<dd><p><code>aem</code> object.</p></dd>


<dt id="arg-x-">x0<a class="anchor" aria-label="anchor" href="#arg-x-"></a></dt>
<dd><p>numeric vector with starting x locations of the particles.</p></dd>


<dt id="arg-y-">y0<a class="anchor" aria-label="anchor" href="#arg-y-"></a></dt>
<dd><p>numeric vector with starting y locations of the particles.</p></dd>


<dt id="arg-z-">z0<a class="anchor" aria-label="anchor" href="#arg-z-"></a></dt>
<dd><p>numeric vector with starting z locations of the particles.</p></dd>


<dt id="arg-times">times<a class="anchor" aria-label="anchor" href="#arg-times"></a></dt>
<dd><p>numeric vector with the times at which particle locations should be registered.</p></dd>


<dt id="arg-forward">forward<a class="anchor" aria-label="anchor" href="#arg-forward"></a></dt>
<dd><p>logical, should forward (<code>TRUE</code>; default) or backward (<code>FALSE</code>) tracking be performed.</p></dd>


<dt id="arg-r">R<a class="anchor" aria-label="anchor" href="#arg-r"></a></dt>
<dd><p>numeric, retardation coefficient passed to <code><a href="flow.html">velocity()</a></code>. Defaults to 1 (no retardation).</p></dd>


<dt id="arg-tfunc">tfunc<a class="anchor" aria-label="anchor" href="#arg-tfunc"></a></dt>
<dd><p>function or list of functions with additional termination events for particles. See details. Defaults to <code>NULL</code>.</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>numeric tolerance used to define when particles have crossed a line element. Defaults to 0.001 length units.</p></dd>


<dt id="arg-ncores">ncores<a class="anchor" aria-label="anchor" href="#arg-ncores"></a></dt>
<dd><p>integer, number of cores to use when running in parallel. Defaults to 0 (no parallel computing). See details.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments passed to <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> or <code><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows()</a></code> when plotting. Otherwise ignored.</p></dd>


<dt id="arg-tracelines">tracelines<a class="anchor" aria-label="anchor" href="#arg-tracelines"></a></dt>
<dd><p>object of class <code>tracelines</code> as returned by <code>tracelines()</code>.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>object of class <code>tracelines</code>.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>ignored</p></dd>


<dt id="arg-add">add<a class="anchor" aria-label="anchor" href="#arg-add"></a></dt>
<dd><p>logical, should the plot be added to the existing plot? Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>character indicating what type of plot to draw. See <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. Defaults to <code>'l'</code> (lines).</p></dd>


<dt id="arg-arrows">arrows<a class="anchor" aria-label="anchor" href="#arg-arrows"></a></dt>
<dd><p>logical indicating if arrows should be drawn using <code><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows()</a></code>. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-marker">marker<a class="anchor" aria-label="anchor" href="#arg-marker"></a></dt>
<dd><p>numeric, time interval at which to plot point markers. Defaults to <code>NULL</code> (no markers). See details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>tracelines()</code> returns an object of class <code>tracelines</code> which is a list with length equal to the number of particles where each list element contains
a matrix with columns <code>time</code>, <code>x</code>, <code>y</code> and <code>z</code> specifying the registered time and coordinates of the particle as it is tracked through the flow field.</p>
<p>The final row represents either the location at the maximum <code>times</code> value or, if the particle terminated prematurely, the time and location of the termination.</p>
<p>The matrices are ordered in increasing time. By connecting the coordinates, the tracelines can be produced.</p>
<p><code>endpoints()</code> returns a matrix with columns <code>time</code>, <code>x</code>, <code>y</code> and <code>z</code> specifying the final time and coordinates
of the particles in the <code>tracelines</code> object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code><a href="https://rdrr.io/pkg/deSolve/man/lsoda.html" class="external-link">deSolve::lsoda()</a></code> is used to numerically integrate the velocity vector.</p>
<p>Particles are terminated prematurely when they have reached the inner annulus of well elements, when they
have crossed a line element (or enter half its non-zero width on either side) or when they travel above the saturated aquifer
level (i.e. the water-table for unconfined conditions or the aquifer top for confined conditions), or below the aquifer base.
Note that these last two conditions can only occur in models with vertical flow components.
The returned time value is the time of termination.</p>
<p>The <code>tfunc</code> argument can be used to specify additional termination events. It is a function (or a list of functions) that
takes arguments <code>t</code>, <code>coords</code> and <code>parms</code>. These are, respectively, a numeric value with the current tracking time,
a numeric vector of length 3 with the current <code>x</code>, <code>y</code> and <code>z</code> coordinate of the particle, and a list with elements
<code>aem</code> and <code>R</code> (named as such). It should return a single logical value indicating if the particle should terminate. See examples.</p>
<p>If initial particle locations are above the saturated aquifer level, they are reset to this elevation with a warning.
Initial particle locations below the aquifer base are reset at the aquifer base with a warning. A small
perturbation is added to these elevations to avoid the particle tracking algorithm to get stuck at these locations.
If the algorithm does get stuck (i.e. excessive run-times), try resetting the <code>z0</code> values to elevations well inside the saturated domain.</p>
<p>Initial particle locations inside a termination point are dropped with a warning.</p>
<p>Backward particle tracking is performed by reversing the flow field (i.e. multiplying the velocities with <code>-1</code>).</p>
<p>Traceline computation is embarrassingly parallel. When <code>ncores &gt; 0</code>, the <code>parallel</code> package is used to set up the cluster with the requested nodes and
the tracelines are computed using <code><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parallel::parLapplyLB()</a></code>. <code>ncores</code> should not exceed the number of available cores as returned by <code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">parallel::detectCores()</a></code>.</p>
<div class="section">
<h3 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a></h3>


<p>The <code>marker</code> value can be used to plot point markers at given time intervals, e.g. every 365 days (see examples).
The x and y locations of each particle at the marked times are obtained by linearly interpolating from the computed particle locations.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="capzone.html">capzone()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># create a model with uniform background flow</span></span></span>
<span class="r-in"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">top</span> <span class="op">&lt;-</span> <span class="fl">10</span>; <span class="va">base</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span></span>
<span class="r-in"><span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="va">hc</span> <span class="op">&lt;-</span> <span class="fl">20</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">uf</span> <span class="op">&lt;-</span> <span class="fu"><a href="uniformflow.html">uniformflow</a></span><span class="op">(</span>TR <span class="op">=</span> <span class="fl">100</span>, gradient <span class="op">=</span> <span class="fl">0.001</span>, angle <span class="op">=</span> <span class="op">-</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="constant.html">constant</a></span><span class="op">(</span><span class="va">TR</span>, xc <span class="op">=</span> <span class="op">-</span><span class="fl">1000</span>, yc <span class="op">=</span> <span class="fl">0</span>, hc <span class="op">=</span> <span class="va">hc</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="aem.html">aem</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">top</span>, <span class="va">base</span>, n <span class="op">=</span> <span class="va">n</span>, <span class="va">uf</span>, <span class="va">rf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate forward particle traces</span></span></span>
<span class="r-in"><span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">200</span>; <span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">200</span>, <span class="fl">200</span>, <span class="fl">200</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span> <span class="op">*</span> <span class="fl">365</span>, <span class="fl">365</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu">tracelines</span><span class="op">(</span><span class="va">m</span>, x0 <span class="op">=</span> <span class="va">x0</span>, y0 <span class="op">=</span> <span class="va">y0</span>, z <span class="op">=</span> <span class="va">top</span>, times <span class="op">=</span> <span class="va">times</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">endp</span> <span class="op">&lt;-</span> <span class="fu">endpoints</span><span class="op">(</span><span class="va">paths</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">500</span>, <span class="fl">500</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">yg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">300</span>, <span class="fl">300</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="contours.html">contours</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">xg</span>, <span class="va">yg</span>, col <span class="op">=</span> <span class="st">'dodgerblue'</span>, nlevels <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'orange'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">endp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>, <span class="st">'y'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Backward tracking with retardation; plot point marker every 5 years</span></span></span>
<span class="r-in"><span><span class="va">paths_back</span> <span class="op">&lt;-</span> <span class="fu">tracelines</span><span class="op">(</span><span class="va">m</span>, x0 <span class="op">=</span> <span class="va">x0</span>, y0 <span class="op">=</span> <span class="va">y0</span>, z0 <span class="op">=</span> <span class="va">top</span>, times <span class="op">=</span> <span class="va">times</span>, R <span class="op">=</span> <span class="va">R</span>, forward <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths_back</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'forestgreen'</span>, marker <span class="op">=</span> <span class="fl">5</span><span class="op">*</span><span class="fl">365</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tracelines-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -------</span></span></span>
<span class="r-in"><span><span class="co"># Termination at wells, line-sinks and user-defined zone</span></span></span>
<span class="r-in"><span><span class="va">w1</span> <span class="op">&lt;-</span> <span class="fu"><a href="well.html">well</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">50</span>, Q <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">w2</span> <span class="op">&lt;-</span> <span class="fu"><a href="well.html">well</a></span><span class="op">(</span><span class="op">-</span><span class="fl">200</span>, <span class="op">-</span><span class="fl">100</span>, Q <span class="op">=</span> <span class="fl">450</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="headlinesink.html">headlinesink</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>, y0 <span class="op">=</span> <span class="fl">100</span>, x1 <span class="op">=</span> <span class="fl">400</span>, y1 <span class="op">=</span> <span class="op">-</span><span class="fl">300</span>, hc <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="aem.html">aem</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">top</span>, <span class="va">base</span>, n <span class="op">=</span> <span class="va">n</span>, <span class="va">uf</span>, <span class="va">rf</span>, <span class="va">w1</span>, <span class="va">w2</span>, <span class="va">ls</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># User-defined termination in rectangular zone</span></span></span>
<span class="r-in"><span><span class="va">tzone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">300</span>, <span class="op">-</span><span class="fl">200</span>, <span class="op">-</span><span class="fl">200</span>, <span class="op">-</span><span class="fl">300</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">150</span>, <span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">termf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">coords</span>, <span class="va">parms</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">in_poly</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tzone</span><span class="op">[</span>,<span class="st">'x'</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">tzone</span><span class="op">[</span>,<span class="st">'x'</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>    <span class="va">y</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tzone</span><span class="op">[</span>,<span class="st">'y'</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">y</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">tzone</span><span class="op">[</span>,<span class="st">'y'</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">in_poly</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">300</span>, <span class="op">-</span><span class="fl">200</span>, <span class="fl">0</span>, <span class="fl">200</span>, <span class="fl">300</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span> <span class="op">*</span> <span class="fl">365</span>, <span class="fl">365</span> <span class="op">/</span> <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu">tracelines</span><span class="op">(</span><span class="va">m</span>, x0 <span class="op">=</span> <span class="va">x0</span>, y0 <span class="op">=</span> <span class="va">y0</span>, z0 <span class="op">=</span> <span class="va">top</span>, times <span class="op">=</span> <span class="va">times</span>, tfunc <span class="op">=</span> <span class="va">termf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="contours.html">contours</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">xg</span>, <span class="va">yg</span>, col <span class="op">=</span> <span class="st">'dodgerblue'</span>, nlevels <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="va">tzone</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'orange'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tracelines-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -------</span></span></span>
<span class="r-in"><span><span class="co"># model with vertical flow due to area-sink</span></span></span>
<span class="r-in"><span><span class="va">as</span> <span class="op">&lt;-</span> <span class="fu"><a href="areasink.html">areasink</a></span><span class="op">(</span>xc <span class="op">=</span> <span class="fl">0</span>, yc <span class="op">=</span> <span class="fl">0</span>, N <span class="op">=</span> <span class="fl">0.001</span>, R <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="aem.html">aem</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">top</span>, <span class="va">base</span>, n <span class="op">=</span> <span class="va">n</span>, <span class="va">uf</span>, <span class="va">rf</span>, <span class="va">w1</span>, <span class="va">w2</span>, <span class="va">as</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># starting z0 locations are above aquifer top and will be reset to top with warning</span></span></span>
<span class="r-in"><span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">400</span>, <span class="fl">200</span>, <span class="fl">200</span><span class="op">)</span>; <span class="va">y0</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span> <span class="op">*</span> <span class="fl">365</span>, <span class="fl">365</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">paths</span> <span class="op">&lt;-</span> <span class="fu">tracelines</span><span class="op">(</span><span class="va">m</span>, x0 <span class="op">=</span> <span class="va">x0</span>, y0 <span class="op">=</span> <span class="va">y0</span>, z0 <span class="op">=</span> <span class="va">top</span> <span class="op">+</span> <span class="fl">0.5</span>, times <span class="op">=</span> <span class="va">times</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Resetting z0 values above saturated aquifer level or below aquifer base</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="contours.html">contours</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">xg</span>, <span class="va">yg</span>, col <span class="op">=</span> <span class="st">'dodgerblue'</span>, nlevels <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'orange'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tracelines-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -------</span></span></span>
<span class="r-in"><span><span class="co"># plot vertical cross-section of traceline 4 along increasing y-axis (from south to north)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'y'</span>, <span class="st">'z'</span><span class="op">)</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">'l'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tracelines-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -------</span></span></span>
<span class="r-in"><span><span class="co"># parallel computing by setting ncores &gt; 0</span></span></span>
<span class="r-in"><span><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="aem.html">aem</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">top</span>, <span class="va">base</span>, n <span class="op">=</span> <span class="va">n</span>, <span class="va">uf</span>, <span class="va">rf</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pathsp</span> <span class="op">&lt;-</span> <span class="fu">tracelines</span><span class="op">(</span><span class="va">mp</span>, x0 <span class="op">=</span> <span class="va">x0</span>, y0 <span class="op">=</span> <span class="va">y0</span>, z <span class="op">=</span> <span class="va">top</span>, times <span class="op">=</span> <span class="va">times</span>, ncores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -------</span></span></span>
<span class="r-in"><span><span class="co"># plot arrows</span></span></span>
<span class="r-in"><span><span class="fu"><a href="contours.html">contours</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">xg</span>, <span class="va">yg</span>, col <span class="op">=</span> <span class="st">'dodgerblue'</span>, nlevels <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'orange'</span>, arrows <span class="op">=</span> <span class="cn">TRUE</span>, length <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tracelines-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot point markers every 2.5 years</span></span></span>
<span class="r-in"><span><span class="fu"><a href="contours.html">contours</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">xg</span>, <span class="va">yg</span>, col <span class="op">=</span> <span class="st">'dodgerblue'</span>, nlevels <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'orange'</span>, marker <span class="op">=</span> <span class="fl">2.5</span> <span class="op">*</span> <span class="fl">365</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot point markers every 600 days</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">paths</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'forestgreen'</span>, marker <span class="op">=</span> <span class="fl">600</span>, pch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tracelines-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cas Neyens.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

